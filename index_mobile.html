<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="js/function.js"></script>
    <script src="js/card_info.js"></script>
    
    <title>NIVEL ARENA Deck Builder (Chart Optimized)</title>
    
    <style>
        /* === 全局設定 === */
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 10px; background-color: #f8f9fa; font-size: 16px; padding-bottom: 90px; }
        
        /* === 圖片樣式 === */
        img { 
            width: 100%; height: auto; aspect-ratio: 2/3; object-fit: contain; 
            border-radius: 4px; box-shadow: 1px 1px 3px rgba(0,0,0,0.2); display: block; 
        }
        img:active { transform: scale(0.96); }
        .icon_img { height: 16px; width: auto; border: none !important; box-shadow: none; vertical-align: middle; margin: 0 2px; display: inline-block; aspect-ratio: auto; }

        /* === 浮動預覽圖層 === */
        #hover-overlay {
            position: fixed; display: none; z-index: 9999; pointer-events: none;
            background: rgba(0, 0, 0, 0.6); padding: 5px; border-radius: 8px;
            backdrop-filter: blur(2px); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #hover-overlay img { max-width: 320px; width: auto; height: auto; border-radius: 6px; box-shadow: none; display: block; aspect-ratio: auto; }

        /* Hover 效果 (僅限非觸控) */
        @media (hover: hover) {
            .deck-scroll-container img:hover, .main-deck-grid img:hover, #rdeck_table_wrapper img:hover {
                outline: 3px solid #007bff; cursor: pointer; filter: brightness(1.1); transition: all 0.1s;
            }
        }

        /* === UI 元件 === */
        button, .custom-file-upload, select, input[type="text"] {
            height: 40px; padding: 0 10px; margin: 2px; font-size: 14px;
            border: 1px solid #ddd; border-radius: 6px; background-color: white; color: #333;
        }
        button { font-weight: 600; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        button:active { background-color: #e9ecef; }
        label { display: inline-flex; align-items: center; margin: 4px 8px 4px 0; font-size: 0.9em; }
        input[type=checkbox] { transform: scale(1.2); margin-right: 6px; }

        /* === 佈局 === */
        .container { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .top-controls {
            background: white; padding: 8px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex; flex-wrap: wrap; gap: 5px; align-items: center; position: sticky; top: 0; z-index: 500;
        }

        /* === 圖表區 === */
        details summary {
            padding: 10px; background: #fff; font-weight: bold; cursor: pointer;
            list-style: none; display: flex; justify-content: space-between; align-items: center; user-select: none;
            border-radius: 8px; transition: background 0.2s;
        }
        details summary:hover { background-color: #f1f1f1; }
        details summary::-webkit-details-marker { display: none; }
        details summary::after { content: '+'; font-size: 1.5em; color: #888; font-weight: normal; line-height: 1; }
        details[open] summary { border-bottom: 1px solid #eee; border-radius: 8px 8px 0 0; }
        details[open] summary::after { content: '-'; }

        .charts-wrapper { background: white; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); overflow: hidden; }
        .charts-content { padding: 15px; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; }
        .chart-card { background: #fff; border: 1px solid #f0f0f0; border-radius: 8px; padding: 10px; display: flex; flex-direction: column; align-items: center; height: 250px; }
        .chart-title { font-size: 0.85em; font-weight: bold; color: #666; margin-bottom: 5px; width: 100%; text-align: left; border-bottom: 1px solid #f0f0f0; padding-bottom: 3px; }
        .chart-box { width: 100%; flex: 1; position: relative; min-height: 0; }

        /* === 牌組與搜尋結果 === */
        .deck-section { 
            background: white; padding: 15px; border-radius: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.03); width: 100%; 
            position: relative; z-index: 1;
        }
        .deck-header { 
            font-size: 1.05em; font-weight: bold; color: #444; 
            margin: 5px 0 5px 0; padding-left: 8px; border-left: 4px solid #666;
            background-color: #f9f9f9; padding: 5px 10px; border-radius: 4px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .deck-header.main { border-left-color: #007bff; background-color: #eef6ff; margin-top: 15px; }

        /* Leader Deck (Single Card) */
        .deck-scroll-container {
            display: flex; justify-content: flex-start; gap: 10px; padding: 10px; 
            min-height: 120px;
        }
        .deck-scroll-container img { width: 85px; flex-shrink: 0; }

        /* Main Deck Grid (10x4 or 5x8) */
        .grid-layout {
            display: grid; gap: 4px; width: 100%; padding-top: 5px; align-items: start;
            grid-template-columns: repeat(5, 1fr); /* Mobile: 5 cols */
        }

        #rdeck_table_wrapper table { width: 100%; }
        #rdeck_table_wrapper table td { display: block; }
        #rdeck_table_wrapper img { width: 100% !important; margin: 0 !important; }
        #rdeck_table_wrapper #larrow, #rdeck_table_wrapper #rarrow { display: none !important; }

        /* === 篩選器 === */
        .filters-section { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.03); width: 100%; }
        .filter-content { padding: 15px; background: #fcfcfc; }
        .filter-group { margin-bottom: 12px; border-bottom: 1px dashed #eee; padding-bottom: 12px; }

        /* === 分頁與彈窗 === */
        .pagination {
            position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95);
            padding: 10px 20px; box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center; z-index: 900; backdrop-filter: blur(2px);
        }
        .modal-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);
            z-index: 3000; display: none; backdrop-filter: blur(2px);
        }
        .modal-content {
            background: white; width: 90%; max-width: 600px; height: 85%; margin: 5% auto;
            border-radius: 12px; padding: 20px; overflow-y: auto; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #cardinformation {
            position: fixed !important; top: 50% !important; left: 50% !important; transform: translate(-50%, -50%) !important;
            margin: 0 !important; width: 90%; max-width: 400px; max-height: 85vh; background: white; border-radius: 12px;
            z-index: 2000; display: flex; flex-direction: column; padding: 15px; visibility: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }

        /* === RWD 斷點 === */
        @media (min-width: 700px) {
            .grid-layout { grid-template-columns: repeat(10, 1fr); }
            .deck-scroll-container img { width: 100px; } /* 平板上 Leader 卡片大一點 */
        }
        @media (min-width: 1200px) {
            .container { display: grid; grid-template-columns: 320px 1fr; align-items: start; }
            .top-controls, .charts-wrapper { grid-column: 1 / -1; }
            .filters-section { position: sticky; top: 70px; }
        }
    </style>
</head>
<body>
    <div id="hover-overlay"><img id="hover-overlay-img" src="" alt="Preview"></div>

    <script>
        // === 全局變數初始化 (Nivel Arena) ===
        var page = 0, deckNamelist = [], sort_method = 0;
        var ldeckArr = [];
        var mdeckArr = []; 
        var rdeckArr = []; 

        var mdeck_1 = 0, mdeck_2 = 0, mdeck_3 = 0, mdeck_4 = 0, mdeck_5 = 0, mdeck_6 = 0, mdeck_7 = 0, mdeck_8 = 0;
        var mdeck_unit = 0, mdeck_skill = 0, mdeck_item = 0;
        var levelobj, typeobj;

        window.oldCommentEvent = window.commentEvent;
        window.commentEvent = function() {
            const textarea = document.getElementById('comment');
            if (textarea && typeof autoResize !== 'undefined') {
                textarea.addEventListener('input', autoResize);
                autoResize.call(textarea);
            }
        };

        window.showrdeck = function() {
            var i = 0, max = 0, ITEMS_PER_PAGE = 20;
            for(i = 0; i < ITEMS_PER_PAGE; i++) {
                $("#rdeck_" + i).attr("src", "img/empty.jpg").attr("alt", "").removeAttr("style").removeAttr("width").removeAttr("height");
            }
            if(rdeckArr.length < (page + 1) * ITEMS_PER_PAGE) max = rdeckArr.length % ITEMS_PER_PAGE || (rdeckArr.length > 0 ? ITEMS_PER_PAGE : 0);
            else max = ITEMS_PER_PAGE;

            for(i = 0; i < ITEMS_PER_PAGE; i++) {
                if(i < max) {
                    var cardIdx = page * ITEMS_PER_PAGE + i;
                    if (cardIdx < rdeckArr.length) {
                        var card = rdeckArr[cardIdx];
                        $("#rdeck_" + i).attr("src", card[SRC]).attr("alt", card[ID]);
                    }
                }
            }
            $("#totalCard").html(rdeckArr.length);
            if(rdeckArr.length == 0) $("#page").html("");
            else $("#page").html((page + 1) + " / " + Math.ceil(rdeckArr.length / ITEMS_PER_PAGE));
        }

        window.showAlldeck = function() {
            showLdeck();
            showMdeck();
        }

        window.showLdeck = function() {
            if(ldeckArr.length > 0) {
                $("#ldeck_0").attr("src", ldeckArr[0][SRC]).attr("alt", ldeckArr[0][ID]);
            } else {
                $("#ldeck_0").attr("src", "img/empty.jpg").attr("alt", "");
            }
        }

        window.showMdeck = function() {
            mdeck_1 = 0; mdeck_2 = 0; mdeck_3 = 0; mdeck_4 = 0; mdeck_5 = 0; mdeck_6 = 0; mdeck_7 = 0; mdeck_8 = 0;
            mdeck_unit = 0; mdeck_skill = 0; mdeck_item = 0;

            for(var i = 0; i < 40; i++) {
                if(i < mdeckArr.length) {
                    var card = mdeckArr[i];
                    $("#mdeck_" + i).attr("src", card[SRC]).attr("alt", card[ID]);
                    
                    var cost = parseInt(card[COST] || 0); 
                    if(cost <= 1) mdeck_1++;
                    else if(cost == 2) mdeck_2++;
                    else if(cost == 3) mdeck_3++;
                    else if(cost == 4) mdeck_4++;
                    else if(cost == 5) mdeck_5++;
                    else if(cost == 6) mdeck_6++;
                    else if(cost == 7) mdeck_7++;
                    else mdeck_8++;

                    if(card[TYPE] == "ユニット") mdeck_unit++;
                    else if(card[TYPE] == "スキル") mdeck_skill++;
                    else if(card[TYPE] == "アイテム") mdeck_item++;

                } else {
                    $("#mdeck_" + i).attr("src", "img/empty.jpg").attr("alt", "");
                }
            }
            updatechart();
        }

        window.updatechart = function() {
            if(levelobj) {
                levelobj.data.datasets[0].data = [mdeck_1, mdeck_2, mdeck_3, mdeck_4, mdeck_5, mdeck_6, mdeck_7, mdeck_8];
                levelobj.update();
            }
            if(typeobj) {
                typeobj.data.datasets[0].data = [mdeck_unit, mdeck_skill, mdeck_item];
                typeobj.update();
            }
        }

        window.changePage = function(x) {
            var ITEMS_PER_PAGE = 20;
            if(rdeckArr.length <= ITEMS_PER_PAGE) return;
            if(x == "back") {
                if(page != 0) page--;
                else page = Math.ceil(rdeckArr.length / ITEMS_PER_PAGE) - 1;
            } else {
                if((page + 1) * ITEMS_PER_PAGE < rdeckArr.length) page++;
                else page = 0;
            }
            showrdeck();
        }

        window.addDeckNivel = function(x) {
            var i = 0;
            if(!x.alt) return;
            for(i=0; i<cardData.length; i++) {
                if(x.alt == cardData[i][ID]) {
                    if(cardData[i][TYPE] == "リーダー") {
                        if(ldeckArr.length == 0) {
                            ldeckArr.push(cardData[i]);
                            showLdeck();
                        } else {
                            ldeckArr[0] = cardData[i];
                            showLdeck();
                        }
                    } else {
                        if(mdeckArr.length < 40) {
                            mdeckArr.push(cardData[i]); 
                            showMdeck();
                        }
                    }
                    break;
                }
            }
        }

        $(document).ready(function() {
            if(typeof onLoading === 'function') onLoading();
            showrdeck();
            
            // 初始化 Charts
            const levelctx = document.getElementById('levelChart');
            if(levelctx) {
                // Register DataLabels globally or for this chart
                Chart.register(ChartDataLabels);
                
                levelobj = new Chart(levelctx, {
                    type: 'bar',
                    data: { labels: ['≤1','2','3','4','5','6','7','≥8'], datasets: [{ label: 'Count', data: [0,0,0,0,0,0,0,0], backgroundColor: '#333' }] },
                    options: { 
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: {
                            padding: {
                                top: 30 // [關鍵] 增加頂部 Padding，防止數字被切掉
                            }
                        },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                display: false, // 隱藏 Y 軸，靠 DataLabel 顯示數值
                                grid: { display: false } 
                            }, 
                            x: { grid: { display: false } } 
                        }, 
                        plugins: { 
                            legend: { display: false }, 
                            datalabels: { 
                                anchor: 'end', 
                                align: 'end',
                                color: '#000',
                                font: { weight: 'bold' }
                            } 
                        } 
                    }
                });
            }
            const typectx = document.getElementById('typeChart');
            if(typectx) {
                typeobj = new Chart(typectx, {
                    type: 'doughnut',
                    data: { labels: ['Unit','Skill','Item'], datasets: [{ data: [0,0,0], backgroundColor: ['#C0C0C0', '#808080', '#000'] }] },
                    options: { plugins: { legend: { position: 'right' }, maintainAspectRatio: false } }
                });
            }

            // Hover Overlay
            $(document).on('mouseenter', '.deck-scroll-container img, .grid-layout img', function(e) {
                if (window.matchMedia("(hover: none)").matches) return; 
                const src = $(this).attr('src');
                if(!src || src.indexOf('empty.jpg') !== -1) return;
                $('#hover-overlay-img').attr('src', src);
                $('#hover-overlay').show();
            });
            $(document).on('mousemove', function(e) {
                if($('#hover-overlay').is(':visible')) {
                    const overlay = $('#hover-overlay');
                    const offset = 20; 
                    let top = e.clientY + offset;
                    let left = e.clientX + offset;
                    if (e.clientX > window.innerWidth * 0.6) left = e.clientX - overlay.width() - offset;
                    if (e.clientY > window.innerHeight * 0.6) top = e.clientY - overlay.height() - offset;
                    overlay.css({ top: top + 'px', left: left + 'px' });
                }
            });
            $(document).on('mouseleave', '.deck-scroll-container img, .grid-layout img', function() {
                $('#hover-overlay').hide();
            });
        });
    </script>

    <div id='cardinformation'>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="margin:0;">Card Details</h3>
            <button onclick="$('#cardinformation').css('visibility', 'hidden');" style="padding: 5px 12px;">✕</button>
        </div>
        <div style="flex: 1; overflow-y: auto;">
            <img id="big_pic" src="img/card_back.jpg" onclick="addDeckNivel(this)" style="display:block; margin:0 auto 10px auto; max-height:280px;">
            <table id="infoTable"></table>
        </div>
        <button class="primary" style="margin-top:10px; width:100%;" onclick="addDeckNivel(document.getElementById('big_pic'));">Add to Deck</button>
        <img id="cross" src="img/cancel_icon.png" style="display:none;">
    </div>

    <div class="top-controls">
        <select id="selectLang"><option value="JP">JP</option><option value="TW">TW</option></select>
        <select id="selectDeck" onchange="selectDeck();" style="flex: 1; min-width: 130px;"><option value="">-- Deck --</option></select>
        <button class="primary" onclick="customizeWindowEvent('code');">Menu</button>
        <button onclick="customizeWindowEvent('list');">List</button>
        <button class="danger" onclick="cleardeck()">Clear</button>
    </div>

    <div class="charts-wrapper">
        <details open>
            <summary>Deck Statistics (圖表統計)</summary>
            <div class="charts-content">
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-title">Level Curve</div>
                        <div class="chart-box"><canvas id="levelChart"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Type Ratio</div>
                        <div class="chart-box"><canvas id="typeChart"></canvas></div>
                    </div>
                </div>
            </div>
        </details>
    </div>

    <div class="container">
        <div class="filters-section">
            <details open>
                <summary>Filters & Search (搜尋/篩選)</summary>
                <div class="filter-content">
                    <div class="filter-group">
                        <input type="text" id="textsearch" placeholder="Search..." style="width: 100%;">
                        <div style="display:flex; gap:10px; margin-top:5px;">
                            <button class="primary" onclick="search();" style="flex:1;">Search</button>
                            <button onclick="uncheckall();" style="flex:1;">Reset</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <b>Type:</b><br>
                        <label><input type="checkbox" id="leader" checked> Leader</label>
                        <label><input type="checkbox" id="unit" checked> Unit</label>
                        <label><input type="checkbox" id="skill" checked> Skill</label>
                        <label><input type="checkbox" id="item" checked> Item</label>
                    </div>
                    <div class="filter-group">
                        <b>Color:</b><br>
                        <label><input type="checkbox" id="red" checked> Red</label>
                        <label><input type="checkbox" id="green" checked> Green</label>
                        <label><input type="checkbox" id="violet" checked> Violet</label>
                        <label><input type="checkbox" id="blue" checked> Blue</label>
                        <label><input type="checkbox" id="yellow" checked> Yellow</label>
                    </div>
                    <div class="filter-group">
                        <b>Cost:</b><br>
                        <label><input type="checkbox" id="cost0" checked> 0</label>
                        <label><input type="checkbox" id="cost1" checked> 1</label>
                        <label><input type="checkbox" id="cost2" checked> 2</label>
                        <label><input type="checkbox" id="cost3" checked> 3</label>
                        <label><input type="checkbox" id="cost4" checked> 4</label>
                        <label><input type="checkbox" id="cost5" checked> 5</label>
                        <label><input type="checkbox" id="cost6" checked> 6</label>
                        <label><input type="checkbox" id="cost7" checked> 7</label>
                        <label><input type="checkbox" id="cost8" checked> 8+</label>
                    </div>
                    <div class="filter-group">
                        <b>Trigger:</b><br>
                        <label><input type="checkbox" id="trigger" checked> Yes</label>
                        <label><input type="checkbox" id="no_trigger" checked> No</label>
                    </div>
                    <div class="filter-group">
                        <b>Icon / Skill:</b><br>
                        <label><input type="checkbox" id="entry" checked> Entry</label>
                        <label><input type="checkbox" id="attack" checked> Attack</label>
                        <label><input type="checkbox" id="defender" checked> Defender</label>
                        <label><input type="checkbox" id="exit" checked> Exit</label>
                        <label><input type="checkbox" id="passive" checked> Passive</label><br>
                        <label><input type="checkbox" id="active_main" checked> Active</label>
                        <label><input type="checkbox" id="levellink" checked> Level Link</label>
                        <label><input type="checkbox" id="battleline" checked> Battleline</label>
                        <label><input type="checkbox" id="guardian" checked> Guardian</label>
                        <label><input type="checkbox" id="armored" checked> Armored</label>
                    </div>
                    <div class="filter-group">
                        <select id="selectType" style="width:100%;"><option value="0">-- All Type --</option><option value="ベース">ベース</option><option value="エフェクト">エフェクト</option><option value="ユニーク">ユニーク</option></select>
                        <select id="selectBelong" style="width:100%; margin-top:5px;"><option value="0">-- All Belong --</option><option value="エリシオン">エリシオン</option><option value="テトラ">テトラ</option><option value="ミシリス">ミシリス</option><option value="ピルグリム">ピルグリム</option></select>
                        <select id="selectProduct" style="width:100%; margin-top:5px;"><option value="0">-- All Product --</option><option value="BT02">BT02</option><option value="ST04">ST04</option><option value="ST05">ST05</option><option value="BT01">BT01</option><option value="ST01">ST01</option><option value="ST02">ST02</option><option value="ST03">ST03</option></select>
                    </div>
                </div>
            </details>
        </div>

        <div style="display:flex; flex-direction:column; gap:15px; width:100%;">
            <div class="deck-section">
                <div class="deck-header">Leader</div>
                <div class="deck-scroll-container">
                    <img id="ldeck_0" src="img/empty.jpg" onclick="delDeck(this,0,ldeckArr)" oncontextmenu="addDeckNivel(this); return false;">
                </div>

                <div class="deck-header main">Main Deck</div>
                <div class="main-deck-grid grid-layout">
                    <script>
                        for(let i=0; i<40; i++) {
                            document.write(`<img id="mdeck_${i}" src="img/empty.jpg" onclick="delDeck(this,${i},mdeckArr)" oncontextmenu="addDeckNivel(this); return false;">`);
                        }
                    </script>
                </div>
            </div>

            <div class="deck-section">
                <div class="deck-header results">
                    Search Results
                    <span style="font-size:0.9em; font-weight:normal;">Total: <span id="totalCard" style="color:#007bff">0</span></span>
                </div>
                <div id="rdeck_table_wrapper" class="grid-layout">
                    <script>
                        for(let i=0; i<20; i++) {
                            document.write(`<img id="rdeck_${i}" onclick="onTabletCardClick(this)" alt="">`);
                        }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <div class="pagination">
        <button onclick="changePage('back')" style="flex:1; margin-right:10px;">&lt; Prev</button>
        <span id="page" style="font-weight:bold; color:#333;"></span>
        <button onclick="changePage('next')" style="flex:1; margin-left:10px;">Next &gt;</button>
    </div>

    <div id="window-container-code" class="modal-container">
        <div id="window-pop-code" class="modal-content" style="text-align:center;">
            <h3>Menu / Tools</h3>
            <input type="text" id="deckTitle" value="My Deck" style="width:100%;">
            <textarea id="textCode" style="width:100%; height:120px; margin-top:10px; border:1px solid #ccc; padding:5px; border-radius:6px;"></textarea>
            <div id="deckStr" style="color:green; height:20px; font-size:0.9em;"></div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                <button onclick="copyClipboard()">Copy Code</button>
                <button onclick="addDecklist()">Save to List</button>
                <button onclick="downloadBlob('','text/csv')">Download CSV</button>
                <label class="custom-file-upload" style="text-align:center; cursor:pointer; width:auto; margin:4px 0;">Import CSV <input id="fileinput" type="file" style="display:none;"></label>
                <button class="danger" onclick="resetDefault()">Reset All</button>
                <button class="danger" onclick="resetComment()">Clear Note</button>
            </div>
            <button onclick="$('#window-container-code').hide()" style="width:100%; margin-top:15px; background:#666; color:white;">Close</button>
        </div>
    </div>
    
    <div id="window-container-list" class="modal-container">
        <div id="window-pop-list" class="modal-content">
            <div style="display:flex; justify-content:space-between;"><h3>Card List</h3><button onclick="$('#window-container-list').hide()">Close</button></div>
            <div id="decklist" style="overflow-y:auto; height:90%;"></div>
        </div>
    </div>

    <script>
        function onTabletCardClick(img) {
            if(!img.alt) return;
            var c = null;
            for(var i=0; i<cardData.length; i++) if(cardData[i][ID]==img.alt) { c=cardData[i]; break; }
            if(c) {
                $("#big_pic").attr("src", c[SRC]).attr("alt", c[ID]);
                if(typeof showInfotable === 'function') showInfotable(c);
            }
            $("#cardinformation").css("visibility", "visible");
        }
        
        window.oldOnMouseShow = window.onmouseShow;
        window.onmouseShow = function(x, source) { }; 

        function customizeWindowEvent(x) {
            if(x==='code') $('#window-container-code').show();
            else if(x==='list') { $('#window-container-list').show(); if(typeof showList==='function') showList(); }
        }
    </script>
</body>
</html>